{"ast":null,"code":"import React,{useState,useEffect}from'react';import axios from'axios';import{useNavigate}from'react-router-dom';import*as echarts from'echarts';import{jsx as _jsx,Fragment as _Fragment,jsxs as _jsxs}from\"react/jsx-runtime\";const Main=()=>{const[isLoggedIn,setIsLoggedIn]=useState(false);const[csrfToken,setCsrfToken]=useState(null);const[userInfo,setUserInfo]=useState(null);const[statuses,setStatuses]=useState([]);const navigate=useNavigate();useEffect(()=>{// 로그인 상태 확인\nconst checkLoginStatus=async()=>{try{const response=await axios.get('/api/check_login/');setIsLoggedIn(response.data.is_logged_in);if(response.data.is_logged_in){const userResponse=await axios.get('/api/user_info/');console.log('User Info:',userResponse.data);// 응답 데이터 출력\nsetUserInfo(userResponse.data);fetchUserStatus();}}catch(error){console.error('로그인 상태 확인 중 오류 발생:',error);}};// CSRF 토큰을 가져오는 함수\nconst fetchCsrfToken=async()=>{try{const response=await axios.get('/api/csrf_token/');setCsrfToken(response.data.csrfToken);}catch(error){console.error('CSRF 토큰을 가져오는 중 오류 발생:',error);}};checkLoginStatus();fetchCsrfToken();// 10분 간격으로 사용자 상태 갱신\nconst interval=setInterval(()=>{if(isLoggedIn){updateUserStatus();}},10*60*1000);return()=>clearInterval(interval);},[isLoggedIn]);const fetchUserStatus=async()=>{try{const response=await axios.get('/api/get_status/');setStatuses(response.data.statuses);renderChart(response.data.statuses);}catch(error){console.error('사용자 상태를 가져오는 중 오류 발생:',error);}};const updateUserStatus=async()=>{try{const response=await axios.post('/api/update_status/',{},{headers:{'X-CSRFToken':csrfToken||''}});fetchUserStatus();}catch(error){console.error('사용자 상태를 갱신하는 중 오류 발생:',error);}};const handleLogout=async()=>{try{await axios.post('/api/logout/',{},{headers:{'X-CSRFToken':csrfToken||''}});setIsLoggedIn(false);navigate('/login');}catch(error){console.error('로그아웃 중 오류 발생:',error);}};const renderChart=data=>{const chartDom=document.getElementById('main');if(!chartDom)return;const myChart=echarts.init(chartDom);const option={title:{text:'User Status Over Time'},tooltip:{trigger:'axis'},xAxis:{type:'category',data:data.map(item=>item.updated_at)},yAxis:{type:'value'},series:[{data:data.map(item=>item.status),type:'line'}]};myChart.setOption(option);};return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{style:{display:'flex',justifyContent:'flex-end',padding:'10px'},children:isLoggedIn?/*#__PURE__*/_jsx(\"button\",{onClick:handleLogout,style:{marginLeft:'10px'},children:\"Logout\"}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>navigate('/login'),style:{marginLeft:'10px'},children:\"Login\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>navigate('/register'),style:{marginLeft:'10px'},children:\"Register\"})]})}),/*#__PURE__*/_jsx(\"div\",{style:{textAlign:'center',marginTop:'20px'},children:isLoggedIn&&userInfo?/*#__PURE__*/_jsxs(\"h1\",{children:[userInfo.name,\"\\uB2D8 (\",userInfo.age,\"\\uC138), \\uD604\\uC7AC \\uC6F9\\uC5D0 \\uC811\\uC18D\\uD558\\uC168\\uC2B5\\uB2C8\\uB2E4!\"]}):/*#__PURE__*/_jsx(\"h1\",{children:\"Welcome to the Main Page\"})}),/*#__PURE__*/_jsx(\"div\",{id:\"main\",style:{width:'100%',height:'400px'}})]});};export default Main;","map":{"version":3,"names":["React","useState","useEffect","axios","useNavigate","echarts","jsx","_jsx","Fragment","_Fragment","jsxs","_jsxs","Main","isLoggedIn","setIsLoggedIn","csrfToken","setCsrfToken","userInfo","setUserInfo","statuses","setStatuses","navigate","checkLoginStatus","response","get","data","is_logged_in","userResponse","console","log","fetchUserStatus","error","fetchCsrfToken","interval","setInterval","updateUserStatus","clearInterval","renderChart","post","headers","handleLogout","chartDom","document","getElementById","myChart","init","option","title","text","tooltip","trigger","xAxis","type","map","item","updated_at","yAxis","series","status","setOption","children","style","display","justifyContent","padding","onClick","marginLeft","textAlign","marginTop","name","age","id","width","height"],"sources":["/home/azureuser/Desktop/son/safety-detection/mysite/frontend/src/components/Main.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport axios from 'axios';\nimport { useNavigate } from 'react-router-dom';\nimport * as echarts from 'echarts';\n\nconst Main = () => {\n  const [isLoggedIn, setIsLoggedIn] = useState(false);\n  const [csrfToken, setCsrfToken] = useState<string | null>(null);\n  const [userInfo, setUserInfo] = useState<{ name: string; age: number } | null>(null);\n  const [statuses, setStatuses] = useState<{ status: number; updated_at: string }[]>([]);\n  const navigate = useNavigate();\n\n  useEffect(() => {\n    // 로그인 상태 확인\n    const checkLoginStatus = async () => {\n      try {\n        const response = await axios.get('/api/check_login/');\n        setIsLoggedIn(response.data.is_logged_in);\n        if (response.data.is_logged_in) {\n          const userResponse = await axios.get('/api/user_info/');\n          console.log('User Info:', userResponse.data); // 응답 데이터 출력\n          setUserInfo(userResponse.data);\n          fetchUserStatus();\n        }\n      } catch (error) {\n        console.error('로그인 상태 확인 중 오류 발생:', error);\n      }\n    };\n\n    // CSRF 토큰을 가져오는 함수\n    const fetchCsrfToken = async () => {\n      try {\n        const response = await axios.get('/api/csrf_token/');\n        setCsrfToken(response.data.csrfToken);\n      } catch (error) {\n        console.error('CSRF 토큰을 가져오는 중 오류 발생:', error);\n      }\n    };\n\n    checkLoginStatus();\n    fetchCsrfToken();\n\n    // 10분 간격으로 사용자 상태 갱신\n    const interval = setInterval(() => {\n      if (isLoggedIn) {\n        updateUserStatus();\n      }\n    }, 10 * 60 * 1000);\n\n    return () => clearInterval(interval);\n  }, [isLoggedIn]);\n\n  const fetchUserStatus = async () => {\n    try {\n      const response = await axios.get('/api/get_status/');\n      setStatuses(response.data.statuses);\n      renderChart(response.data.statuses);\n    } catch (error) {\n      console.error('사용자 상태를 가져오는 중 오류 발생:', error);\n    }\n  };\n\n  const updateUserStatus = async () => {\n    try {\n      const response = await axios.post('/api/update_status/', {}, {\n        headers: {\n          'X-CSRFToken': csrfToken || ''\n        }\n      });\n      fetchUserStatus();\n    } catch (error) {\n      console.error('사용자 상태를 갱신하는 중 오류 발생:', error);\n    }\n  };\n\n  const handleLogout = async () => {\n    try {\n      await axios.post('/api/logout/', {}, {\n        headers: {\n          'X-CSRFToken': csrfToken || ''\n        }\n      });\n      setIsLoggedIn(false);\n      navigate('/login');\n    } catch (error) {\n      console.error('로그아웃 중 오류 발생:', error);\n    }\n  };\n\n  const renderChart = (data: { status: number; updated_at: string }[]) => {\n    const chartDom = document.getElementById('main');\n    if (!chartDom) return;\n    const myChart = echarts.init(chartDom);\n    const option = {\n      title: {\n        text: 'User Status Over Time'\n      },\n      tooltip: {\n        trigger: 'axis'\n      },\n      xAxis: {\n        type: 'category',\n        data: data.map(item => item.updated_at)\n      },\n      yAxis: {\n        type: 'value'\n      },\n      series: [\n        {\n          data: data.map(item => item.status),\n          type: 'line'\n        }\n      ]\n    };\n    myChart.setOption(option);\n  };\n\n  return (\n    <div>\n      <div style={{ display: 'flex', justifyContent: 'flex-end', padding: '10px' }}>\n        {isLoggedIn ? (\n          <button onClick={handleLogout} style={{ marginLeft: '10px' }}>Logout</button>\n        ) : (\n          <>\n            <button onClick={() => navigate('/login')} style={{ marginLeft: '10px' }}>Login</button>\n            <button onClick={() => navigate('/register')} style={{ marginLeft: '10px' }}>Register</button>\n          </>\n        )}\n      </div>\n      <div style={{ textAlign: 'center', marginTop: '20px' }}>\n        {isLoggedIn && userInfo ? (\n          <h1>{userInfo.name}님 ({userInfo.age}세), 현재 웹에 접속하셨습니다!</h1>\n        ) : (\n          <h1>Welcome to the Main Page</h1>\n        )}\n      </div>\n      <div id=\"main\" style={{ width: '100%', height: '400px' }}></div>\n    </div>\n  );\n};\n\nexport default Main;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}