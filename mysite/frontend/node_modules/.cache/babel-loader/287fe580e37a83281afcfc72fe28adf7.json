{"ast":null,"code":"import React,{useState,useEffect}from'react';import axios from'axios';import{useNavigate}from'react-router-dom';import*as echarts from'echarts';import dayjs from'dayjs';import{jsx as _jsx,Fragment as _Fragment,jsxs as _jsxs}from\"react/jsx-runtime\";const Main=()=>{const[isLoggedIn,setIsLoggedIn]=useState(false);const[csrfToken,setCsrfToken]=useState(null);const[userInfo,setUserInfo]=useState(null);const[statuses,setStatuses]=useState([]);const navigate=useNavigate();useEffect(()=>{// 로그인 상태 확인\nconst checkLoginStatus=async()=>{try{const response=await axios.get('/api/check_login/');setIsLoggedIn(response.data.is_logged_in);if(response.data.is_logged_in){const userResponse=await axios.get('/api/user_info/');console.log('User Info:',userResponse.data);// 응답 데이터 출력\nsetUserInfo(userResponse.data);fetchUserStatus();updateUserStatus();// 로그인 직후 사용자 상태 갱신\n}}catch(error){console.error('로그인 상태 확인 중 오류 발생:',error);}};// CSRF 토큰을 가져오는 함수\nconst fetchCsrfToken=async()=>{try{const response=await axios.get('/api/csrf_token/');setCsrfToken(response.data.csrfToken);}catch(error){console.error('CSRF 토큰을 가져오는 중 오류 발생:',error);}};checkLoginStatus();fetchCsrfToken();// 10분 간격으로 사용자 상태 갱신\nconst interval=setInterval(()=>{if(isLoggedIn){updateUserStatus();}},10*60*1000);return()=>clearInterval(interval);},[isLoggedIn]);const fetchUserStatus=async()=>{try{const response=await axios.get('/api/get_status/');setStatuses(response.data.statuses);renderChart(response.data.statuses);}catch(error){console.error('사용자 상태를 가져오는 중 오류 발생:',error);}};const updateUserStatus=async()=>{try{const response=await axios.post('/api/update_status/',{},{headers:{'X-CSRFToken':csrfToken||''}});fetchUserStatus();}catch(error){console.error('사용자 상태를 갱신하는 중 오류 발생:',error);}};const handleLogout=async()=>{try{await axios.post('/api/logout/',{},{headers:{'X-CSRFToken':csrfToken||''}});setIsLoggedIn(false);navigate('/login');}catch(error){console.error('로그아웃 중 오류 발생:',error);}};const renderChart=data=>{const chartDom=document.getElementById('main');if(!chartDom)return;const myChart=echarts.init(chartDom);const option={title:{text:'User Status Over Time'},tooltip:{trigger:'axis',formatter:params=>{const statusText=params[0].data[1]===1?'정상':params[0].data[1]===2?'주의':'위험';return\"\".concat(params[0].data[0],\"<br/>\\uC0C1\\uD0DC: \").concat(statusText);}},xAxis:{type:'category',data:data.map(item=>dayjs(item.updated_at).format('MM-DD HH:mm:ss'))},yAxis:{type:'value'},series:[{data:data.map(item=>[dayjs(item.updated_at).format('MM-DD HH:mm:ss'),item.status]),type:'line',lineStyle:{color:'#5470C6'// 이전 색깔로 변경\n},itemStyle:{color:params=>{if(params.data[1]===1)return'#5470C6';// 점의 색깔을 초록색으로 변경\nif(params.data[1]===2)return'#5470C6';return'#5470C6';},borderWidth:2},symbolSize:10,symbol:'circle'// 점의 모양을 원으로 설정\n}]};myChart.setOption(option);};return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{style:{display:'flex',justifyContent:'flex-end',padding:'10px'},children:isLoggedIn?/*#__PURE__*/_jsx(\"button\",{onClick:handleLogout,style:{marginLeft:'10px'},children:\"Logout\"}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>navigate('/login'),style:{marginLeft:'10px'},children:\"Login\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>navigate('/register'),style:{marginLeft:'10px'},children:\"Register\"})]})}),/*#__PURE__*/_jsx(\"div\",{style:{textAlign:'center',marginTop:'20px'},children:isLoggedIn&&userInfo?/*#__PURE__*/_jsxs(\"h1\",{children:[userInfo.name,\"\\uB2D8 (\",userInfo.age,\"\\uC138), \\uD604\\uC7AC \\uC6F9\\uC5D0 \\uC811\\uC18D\\uD558\\uC168\\uC2B5\\uB2C8\\uB2E4!\"]}):/*#__PURE__*/_jsx(\"h1\",{children:\"Welcome to the Main Page\"})}),/*#__PURE__*/_jsx(\"div\",{id:\"main\",style:{width:'100%',height:'400px'}})]});};export default Main;","map":{"version":3,"names":["React","useState","useEffect","axios","useNavigate","echarts","dayjs","jsx","_jsx","Fragment","_Fragment","jsxs","_jsxs","Main","isLoggedIn","setIsLoggedIn","csrfToken","setCsrfToken","userInfo","setUserInfo","statuses","setStatuses","navigate","checkLoginStatus","response","get","data","is_logged_in","userResponse","console","log","fetchUserStatus","updateUserStatus","error","fetchCsrfToken","interval","setInterval","clearInterval","renderChart","post","headers","handleLogout","chartDom","document","getElementById","myChart","init","option","title","text","tooltip","trigger","formatter","params","statusText","concat","xAxis","type","map","item","updated_at","format","yAxis","series","status","lineStyle","color","itemStyle","borderWidth","symbolSize","symbol","setOption","children","style","display","justifyContent","padding","onClick","marginLeft","textAlign","marginTop","name","age","id","width","height"],"sources":["/home/azureuser/Desktop/son/safety-detection/mysite/frontend/src/components/Main.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport axios from 'axios';\nimport { useNavigate } from 'react-router-dom';\nimport * as echarts from 'echarts';\nimport dayjs from 'dayjs';\n\nconst Main = () => {\n  const [isLoggedIn, setIsLoggedIn] = useState(false);\n  const [csrfToken, setCsrfToken] = useState<string | null>(null);\n  const [userInfo, setUserInfo] = useState<{ name: string; age: number } | null>(null);\n  const [statuses, setStatuses] = useState<{ status: number; updated_at: string }[]>([]);\n  const navigate = useNavigate();\n\n  useEffect(() => {\n    // 로그인 상태 확인\n    const checkLoginStatus = async () => {\n      try {\n        const response = await axios.get('/api/check_login/');\n        setIsLoggedIn(response.data.is_logged_in);\n        if (response.data.is_logged_in) {\n          const userResponse = await axios.get('/api/user_info/');\n          console.log('User Info:', userResponse.data); // 응답 데이터 출력\n          setUserInfo(userResponse.data);\n          fetchUserStatus();\n          updateUserStatus(); // 로그인 직후 사용자 상태 갱신\n        }\n      } catch (error) {\n        console.error('로그인 상태 확인 중 오류 발생:', error);\n      }\n    };\n\n    // CSRF 토큰을 가져오는 함수\n    const fetchCsrfToken = async () => {\n      try {\n        const response = await axios.get('/api/csrf_token/');\n        setCsrfToken(response.data.csrfToken);\n      } catch (error) {\n        console.error('CSRF 토큰을 가져오는 중 오류 발생:', error);\n      }\n    };\n\n    checkLoginStatus();\n    fetchCsrfToken();\n\n    // 10분 간격으로 사용자 상태 갱신\n    const interval = setInterval(() => {\n      if (isLoggedIn) {\n        updateUserStatus();\n      }\n    }, 10 * 60 * 1000);\n\n    return () => clearInterval(interval);\n  }, [isLoggedIn]);\n\n  const fetchUserStatus = async () => {\n    try {\n      const response = await axios.get('/api/get_status/');\n      setStatuses(response.data.statuses);\n      renderChart(response.data.statuses);\n    } catch (error) {\n      console.error('사용자 상태를 가져오는 중 오류 발생:', error);\n    }\n  };\n\n  const updateUserStatus = async () => {\n    try {\n      const response = await axios.post('/api/update_status/', {}, {\n        headers: {\n          'X-CSRFToken': csrfToken || ''\n        }\n      });\n      fetchUserStatus();\n    } catch (error) {\n      console.error('사용자 상태를 갱신하는 중 오류 발생:', error);\n    }\n  };\n\n  const handleLogout = async () => {\n    try {\n      await axios.post('/api/logout/', {}, {\n        headers: {\n          'X-CSRFToken': csrfToken || ''\n        }\n      });\n      setIsLoggedIn(false);\n      navigate('/login');\n    } catch (error) {\n      console.error('로그아웃 중 오류 발생:', error);\n    }\n  };\n\n  const renderChart = (data: { status: number; updated_at: string }[]) => {\n    const chartDom = document.getElementById('main');\n    if (!chartDom) return;\n    const myChart = echarts.init(chartDom);\n    const option = {\n      title: {\n        text: 'User Status Over Time'\n      },\n      tooltip: {\n        trigger: 'axis',\n        formatter: (params: any) => {\n          const statusText = params[0].data[1] === 1 ? '정상' : params[0].data[1] === 2 ? '주의' : '위험';\n          return `${params[0].data[0]}<br/>상태: ${statusText}`;\n        }\n      },\n      xAxis: {\n        type: 'category',\n        data: data.map(item => dayjs(item.updated_at).format('MM-DD HH:mm:ss'))\n      },\n      yAxis: {\n        type: 'value'\n      },\n      series: [\n        {\n          data: data.map(item => [dayjs(item.updated_at).format('MM-DD HH:mm:ss'), item.status]),\n          type: 'line',\n          lineStyle: {\n            color: '#5470C6' // 이전 색깔로 변경\n          },\n          itemStyle: {\n            color: (params: any) => {\n              if (params.data[1] === 1) return '#5470C6'; // 점의 색깔을 초록색으로 변경\n              if (params.data[1] === 2) return '#5470C6';\n              return '#5470C6';\n            },\n            borderWidth: 2\n          },\n          symbolSize: 10,\n          symbol: 'circle' // 점의 모양을 원으로 설정\n        }\n      ]\n    };\n    myChart.setOption(option);\n  };\n\n  return (\n    <div>\n      <div style={{ display: 'flex', justifyContent: 'flex-end', padding: '10px' }}>\n        {isLoggedIn ? (\n          <button onClick={handleLogout} style={{ marginLeft: '10px' }}>Logout</button>\n        ) : (\n          <>\n            <button onClick={() => navigate('/login')} style={{ marginLeft: '10px' }}>Login</button>\n            <button onClick={() => navigate('/register')} style={{ marginLeft: '10px' }}>Register</button>\n          </>\n        )}\n      </div>\n      <div style={{ textAlign: 'center', marginTop: '20px' }}>\n        {isLoggedIn && userInfo ? (\n          <h1>{userInfo.name}님 ({userInfo.age}세), 현재 웹에 접속하셨습니다!</h1>\n        ) : (\n          <h1>Welcome to the Main Page</h1>\n        )}\n      </div>\n      <div id=\"main\" style={{ width: '100%', height: '400px' }}></div>\n    </div>\n  );\n};\n\nexport default Main;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}